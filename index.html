<!DOCTYPE html>
<html lang="en">
<head>
    <title>IsoAlgo3d - Pipeline 3D Viewer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    
    <link href="css/styles.css" rel="stylesheet"/>

    <script src="js/libs/xeogl.js"></script>
    <script src="js/helpers/axisHelper.js"></script>
    <script src="js/geometry/vectorTextGeometry.js"></script>
    <script src="js/annotations/pin.js"></script>
    <script src="js/annotations/annotation.js"></script>

    <link href="js/layui/css/layui.css" rel="stylesheet"/>
    <script src="js/layui/layui.js"></script>
        
<body>

<div id="logos">
    <a href="http://www.cppblog.com/eryar/" target="_blank">
    <img src="images/IsoAlgo.png"></a>
</div>

<button type="button" class="layui-btn" id="loadFile">
    <i class="layui-icon">&#xe67c;</i>Piping File
</button>

<script>

    var IsoAlgo = {
      onRuntimeInitialized: function() {
        IsoAlgo.initViewer();
      }
    };

    var scene = new xeogl.Scene({
      transparent: true,
      backgroundColor: [1, 1, 1, 1]
    });
    
    xeogl.setDefaultScene(scene);

    scene.gammaInput = false;
    scene.gammaOutput = false;

    var camera = scene.camera;
    camera.projection = "ortho";

    camera.eye = [1.8160498142242432, -251.0963897705078, 37.38420486450195];
    camera.look = [0, -0.0011444091796875, 11.182900428771973];
    camera.up = [0, 0, 1]; // +Z is up

    // Configure camera for a World-space in which +Z is considered "up"
    camera.worldAxis = [
        1, 0, 0, // Right
        0, 0, 1, // Up
        0, 1, 0  // Forward
    ];

    // Gimbal lock camera yaw rotation to World +Z axis
    camera.gimbalLock = true;

    // Cameral control for 3d view rotate, zoom, pan.
    var cameraControl = new xeogl.CameraControl();

    var cameraFlight = new xeogl.CameraFlightAnimation();

    new xeogl.AxisHelper({
        camera: scene.camera,
        size: [160, 160],
        visible: true
    });

    // layui
    layui.use('upload', function(){
        var upload = layui.upload;
        var layer = layui.layer;

        layer.open({
            title: 'IsoAlgo3d',
            content: '仅供测试，如需使用请联系作者(eryar@163.com)!',
            icon: 0
        });
       
        // Upload instance.
        var uploadInst = upload.render({
            elem: '#loadFile'
            ,url: '/pipe'
            ,accept: 'file'
            ,exts: 'pcf|idf'  
            ,auto: false
            ,choose: function(obj) {

                obj.preview(function(index, file, result) {
                    var aFileReader = new FileReader();
                    aFileReader.onload = function() {

                        if (file.name.endsWith('idf')) {
                            IsoAlgo.loadIdf(this.result);
                        }
                        else if (file.name.endsWith('pcf')) {
                            IsoAlgo.loadPcf(this.result);
                        }
                        else {
                            alert('Please select PCF/IDF piping file!');
                        }

                        IsoAlgo.fitViewer();
                    }
                    aFileReader.readAsText(file);
                })
            } 
        });
    });

</script>
<script src="js/IsoAlgo/IsoAlgo.js"></script>

</body>
</html>